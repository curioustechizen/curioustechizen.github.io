---
layout: post
title: Google Play Services, and Why We Still Need AccountManager
date: '2012-09-29T12:19:00.001+05:30'
author: Kiran Rao
tags:
- google-play-services
- development
- AccountManager
- oauth
- android
modified_time: '2012-10-03T18:12:46.977+05:30'
blogger_id: tag:blogger.com,1999:blog-1898571694993659507.post-813148812571273654
blogger_orig_url: http://curioustechizen.blogspot.com/2012/09/google-play-services-and-why-we-still.html
---

<h3>Introduction</h3><p>Recently, Google has <a href="http://android-developers.blogspot.ca/2012/09/google-play-services-and-oauth-identity.html">started rolling out</a> the widely awaited <a href="https://developers.google.com/android/google-play-services/">Google Play Services</a>, announced during Google I/O 2012. One of the major pieces of Google Play Services is the <code>GoogleAuthUtil</code>. The principal problem that this component solves is OAuth. Up until now, writing an Android app that requires OAuth has been <strong>complex</strong> and <strong>non-standard</strong>. </p><ul><li>Complex, because you need perform the whole OAuth dance behind the scenes (not specific to Android, mind you). </li><li>Non-standard because the app developers ended up displaying their own custom screens for choosing the account to be used for OAuth. Also, the OAuth scopes are specific to the identity provider; and this led to displaying the <em>raw oauth scope strings</em> in some OAuth confirmation screens rather than a user-friendly description of the scope. </li></ul><p>The <a href="https://developer.android.com/reference/android/accounts/AccountManager.html"><code>AccountManager</code> framework</a> did some of the heavy lifting and attempted to address both the problems. However, it met with limited success on both counts. Which is why, when the <code>GoogleAuthUtil</code>, and the <code>AccountPicker</code> were previewed at IO2012, I was jumping in excitement. If you want your app to use OAuth with Google, then <code>GoogleAuthUtil</code> makes life a whole lot simpler.</p><h3>Caveat</h3><p>But, therein lies the caveat. <strong><em>It only applies to Google Accounts</em></strong>. One could argue that any Android device that has Google Play Services also has at least one Google account - so this is not a big deal. However, remember that many Android apps are actually just one of the ways of accessing a (possibly OAuth-protected) web service. The web service itself might offer several identity providers for the user to sign up, log in or authorize. Restricting that to just the Google account on the Android version of the app doesn't make sense.</p><p>What is really required is for more identity providers to leverage the <code>AccountManager</code> framework in Android. Admittedly, that is not so straightforward. Not only does it involve writing an <code>AccountAuthenticator</code>, there are some pieces specific to identity provider and <strong>there is no go-to place to publish the documentation for these provider-specific pieces</strong>. </p><p>Suppose I wanted to write an app that allows users to sign in with their Google, Facebook or Twitter accounts. Google is easy (it has been easy even before Play Services!). But what about the rest? How do I know what the <code>accountType</code> for Twitter is? How do I know the valid values for <code>features</code> parameter for Twitter? </p><p>But the problem doesn't stop there. Apparently, some third-party services <strong>require you to use their OAuth API to sign the user in</strong>. This is stated explicitly, as part of the terms of services. I noticed this when I was trying out a third party twitter client. I already had Twitter's official client installed, and hence my twitter account was available in the "Accounts" settings. Still, I had to enter my twitter credentials in a WebView. The third-party twitter client did not use AccountManager to log me in. I wrote to the developer about it and I was informed that Twitter required this as part of their terms of service.</p><h3>Solution (?)</h3><p>I really think third party identity providers (at least the big ones) should make an effort to leverage <code>AccountManager</code> framework of Android. This may be additional work - but just look at the size of the customer base they are targetting. With the new <code>AccountPicker</code>, the end user experience for using OAuth with Google is a breeze. It makes the traditional "log in using a web page" seem like a stone-age UX. The driving principle should be:</p><blockquote><p><strong>An end user should never be forced to enter the credentials for an account that is already present in the "Accounts" settings screen</strong></p></blockquote><p>Furthermore, it may project Google in a bad light since it may give the impression that Google is trying to make the UX good for its own services while leaving others in the lurch - which is not true.</p><h3>Conclusion</h3><p>In a nutshell: </p><ul><li>Google Play Services (in particular <code>AccountPicker</code>) = <strong>Good</strong> - for Google Accounts.</li><li>Third party identity providers and OAuth providers: WebView = <strong>Bad</strong>. Please use <code>AccountManager</code> and <code>AbstractAccountAuthenticator</code>.</li></ul>